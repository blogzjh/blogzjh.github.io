<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>MySQL窗口函数及滑窗原理 | 张家豪的博客</title>
  <meta name="keywords" content="">
  <meta name="description" content="MySQL窗口函数及滑窗原理 | 张家豪的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="1.需求背景根据做题的情况，生成对应的短信case（一共十几种case）学情报告)，定时任务发送短信，用户可以通过短信中的短url跳转长url，实现app唤起，打开对应那天的详细学情报告如下图： 2.本次开发中的亮点2.1 发现并配合解决了有道词典的RocketMQ环境问题 发现并解决了测试环境RocketMQ的无感知消息丢失bug————双主双从，其中一个broker的没有写权限（这是有道词典自">
<meta property="og:type" content="article">
<meta property="og:title" content="定时任务发短信">
<meta property="og:url" content="https://blogzjh.github.io/2022/12/26/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%8F%91%E7%9F%AD%E4%BF%A1/index.html">
<meta property="og:site_name" content="张家豪的博客">
<meta property="og:description" content="1.需求背景根据做题的情况，生成对应的短信case（一共十几种case）学情报告)，定时任务发送短信，用户可以通过短信中的短url跳转长url，实现app唤起，打开对应那天的详细学情报告如下图： 2.本次开发中的亮点2.1 发现并配合解决了有道词典的RocketMQ环境问题 发现并解决了测试环境RocketMQ的无感知消息丢失bug————双主双从，其中一个broker的没有写权限（这是有道词典自">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/e0637925022f4d488cd4c38b05b2be67.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/1821ab2e7a0f41d6a7baa13a168d20e4.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/ff0d5d0fc8ee4bc491263ceeddfed854.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/0dfc99a8fff14574bbf84c548805972b.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/07be092f83824b0da13ced7b3dd3869b.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/5284a12b97bf419c8e23e20cc9a5c14f.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/aafded5acab2408d982adc43abc7991a.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/841bafcb3be9409c8404fd78624550f9.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/105b748fa8fe4b61a8b1e3d8a55db572.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/f9ca8d08ad21409b965ff47fe1c959e3.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/68800976353a4f6b8f22c79947172fc4.png">
<meta property="article:published_time" content="2022-12-26T12:33:02.000Z">
<meta property="article:modified_time" content="2022-12-27T15:16:55.291Z">
<meta property="article:author" content="张家豪">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/e0637925022f4d488cd4c38b05b2be67.png">


<link rel="icon" href="/img/QQ图片20211224224200.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/rainbow.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 5.4.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/QQ图片20211224224200.jpg"/>
</a>
<div class="author">
    <span>张家豪</span>
</div>

<div class="icon">
    
        
            <a title="github"
               href="https://github.com/blogzjh"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="csdn"
               href="https://blog.csdn.net/m0_56079407"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-csdn"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:2225674545@qq.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=2225674545&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
</div>




<ul>
    <li>
        <div class="all active" data-rel="全部文章">全部文章
            
                <small>(63)</small>
            
        </div>
    </li>
    
        
            
                <li>
                    <div data-rel="数据结构算法">
                        
                        数据结构算法
                        <small>(6)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="工作笔记">
                        
                        工作笔记
                        <small>(16)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="机器学习">
                        
                        机器学习
                        <small>(7)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="思维导图">
                        
                        思维导图
                        <small>(3)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="源码">
                        
                        源码
                        <small>(9)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="中间件">
                        
                        中间件
                        <small>(13)</small>
                        
                    </div>
                    
                </li>
            
        
    
        
            
                <li>
                    <div data-rel="Java">
                        
                        Java
                        <small>(8)</small>
                        
                    </div>
                    
                </li>
            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="63">
<input type="hidden" id="yelog_site_word_count" value="115.7k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        友情链接
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
            <li><a target="_blank" href="http://yelog.org/">叶落阁</a></li>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="搜索 快捷键 i"></i>
            <div class="right-title">全部文章</div>
            <i class="iconfont icon-file-tree" data-title="切换到大纲视图 快捷键 w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="返回"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="大小写敏感"></i>
            <i class="iconfont icon-tag" data-title="标签"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">大纲</div>
            <i class="iconfont icon-list" data-title="切换到文章列表"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>HashMap</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="全部文章 工作笔记 "
           href="/2022/12/26/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E5%8F%91%E7%9F%AD%E4%BF%A1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="定时任务发短信">定时任务发短信</span>
            <span class="post-date" title="2022-12-26 20:33:02">2022/12/26</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/11/27/MySQL%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E5%8F%8A%E6%BB%91%E7%AA%97%E5%8E%9F%E7%90%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="MySQL窗口函数及滑窗原理">MySQL窗口函数及滑窗原理</span>
            <span class="post-date" title="2022-11-27 22:13:14">2022/11/27</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/11/18/es%E3%80%81head%E3%80%81ik%E7%9A%84%E6%90%AD%E5%BB%BA/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="es、head、ik的搭建">es、head、ik的搭建</span>
            <span class="post-date" title="2022-11-18 15:52:15">2022/11/18</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/11/18/Hive%E7%9A%84DML%E4%BB%A5%E5%8F%8A%E5%90%84%E7%A7%8D%E4%BC%98%E5%8C%96/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hive的DML以及各种优化">Hive的DML以及各种优化</span>
            <span class="post-date" title="2022-11-18 15:51:14">2022/11/18</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/11/18/Hive%E7%9A%84DQL%E4%BB%A5%E5%8F%8A%E5%90%84%E7%A7%8D%E4%BC%98%E5%8C%96/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hive的DQL以及各种优化">Hive的DQL以及各种优化</span>
            <span class="post-date" title="2022-11-18 15:50:12">2022/11/18</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/11/18/%E8%AF%8D%E5%85%B8%E7%9B%B4%E6%92%AD%E4%BB%8E%E6%97%A5%E5%BF%97%E6%8F%90%E5%8F%96%E5%87%A0%E5%8D%81%E4%B8%AA%E6%8C%87%E6%A0%87%E7%9A%84%E6%96%B9%E6%A1%88/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="词典直播从日志提取几十个指标的方案">词典直播从日志提取几十个指标的方案</span>
            <span class="post-date" title="2022-11-18 15:47:03">2022/11/18</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/11/18/%E8%AF%8D%E5%85%B8%E7%94%A8%E6%88%B7%E6%9C%80%E8%BF%91%E7%99%BB%E5%BD%95%E6%97%B6%E9%97%B4%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="词典用户最近登录时间接口设计">词典用户最近登录时间接口设计</span>
            <span class="post-date" title="2022-11-18 15:34:59">2022/11/18</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/11/11/Hive-DDL%E3%80%81%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F%E3%80%81%E5%88%86%E5%8C%BA%E5%88%86%E6%A1%B6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hive DDL、存储方式、分区分桶">Hive DDL、存储方式、分区分桶</span>
            <span class="post-date" title="2022-11-11 10:06:18">2022/11/11</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/11/11/Grafana%E6%8E%A5%E5%85%A5%E3%80%81%E4%BD%BF%E7%94%A8%E3%80%81%E4%B8%8E%E5%88%86%E6%9E%90/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Grafana接入、使用、与分析">Grafana接入、使用、与分析</span>
            <span class="post-date" title="2022-11-11 10:03:12">2022/11/11</span>
        </a>
        
        <a  class="全部文章 思维导图 "
           href="/2022/10/31/Redis%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Redis思维导图1">Redis思维导图1</span>
            <span class="post-date" title="2022-10-31 11:37:31">2022/10/31</span>
        </a>
        
        <a  class="全部文章 思维导图 "
           href="/2022/10/30/RabbitMQ%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RabbitMQ思维导图1">RabbitMQ思维导图1</span>
            <span class="post-date" title="2022-10-30 23:02:47">2022/10/30</span>
        </a>
        
        <a  class="全部文章 思维导图 "
           href="/2022/10/27/MySQL%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="MySQL思维导图1">MySQL思维导图1</span>
            <span class="post-date" title="2022-10-27 22:42:23">2022/10/27</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/09/26/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%81%9A%E9%BB%91%E5%90%8D%E5%8D%95or%E5%8E%BB%E9%87%8D%E7%9A%84%E6%96%B9%E6%A1%88/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="布隆过滤做黑名单or去重的方案">布隆过滤做黑名单or去重的方案</span>
            <span class="post-date" title="2022-09-26 02:22:57">2022/09/26</span>
        </a>
        
        <a  class="全部文章 数据结构算法 "
           href="/2022/09/15/%E4%B8%89%E7%A7%8D%E6%83%85%E5%86%B5%E7%9A%84%E5%B1%82%E5%BA%8F%E9%81%8D%E5%8E%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="三种情况的层序遍历">三种情况的层序遍历</span>
            <span class="post-date" title="2022-09-15 21:21:24">2022/09/15</span>
        </a>
        
        <a  class="全部文章 数据结构算法 "
           href="/2022/09/15/%E5%87%A0%E9%81%93%E5%B2%9B%E5%B1%BF%E9%97%AE%E9%A2%98-dfs-%E5%89%AA%E6%9E%9D-%E5%9B%9E%E6%BA%AF/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="几道岛屿问题:dfs+剪枝+回溯">几道岛屿问题:dfs+剪枝+回溯</span>
            <span class="post-date" title="2022-09-15 21:20:58">2022/09/15</span>
        </a>
        
        <a  class="全部文章 数据结构算法 "
           href="/2022/09/15/%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%9A%E6%9B%BF%E6%8D%A2%E3%80%81%E5%B7%A6%E6%97%8B%E3%80%81%E7%BC%BA%E5%A4%B1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="字符串：替换、左旋、缺失">字符串：替换、左旋、缺失</span>
            <span class="post-date" title="2022-09-15 21:20:41">2022/09/15</span>
        </a>
        
        <a  class="全部文章 数据结构算法 "
           href="/2022/09/15/%E5%87%A0%E9%81%93%E4%BA%8C%E5%8F%89%E6%A0%91-dfs-%E5%9B%9E%E6%BA%AF/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="几道二叉树:dfs+回溯">几道二叉树:dfs+回溯</span>
            <span class="post-date" title="2022-09-15 21:19:53">2022/09/15</span>
        </a>
        
        <a  class="全部文章 数据结构算法 "
           href="/2022/09/15/%E5%87%A0%E9%81%93%E5%8A%A8%E5%BD%92%E6%80%BB%E7%BB%93/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="几道动归总结">几道动归总结</span>
            <span class="post-date" title="2022-09-15 21:18:43">2022/09/15</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/09/15/BeanFactory%E5%92%8CApplicationContext/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="BeanFactory和ApplicationContext">BeanFactory和ApplicationContext</span>
            <span class="post-date" title="2022-09-15 21:17:39">2022/09/15</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/08/28/%E4%B8%89%E7%A7%8D%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9A%84%E5%88%B7%E7%9B%98-%E6%8C%81%E4%B9%85%E5%8C%96-%E7%AD%96%E7%95%A5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="三种中间件的刷盘(持久化)策略">三种中间件的刷盘(持久化)策略</span>
            <span class="post-date" title="2022-08-28 13:34:20">2022/08/28</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/08/28/redis%E5%9F%BA%E7%A1%80/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="redis基础">redis基础</span>
            <span class="post-date" title="2022-08-28 12:21:22">2022/08/28</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/08/27/RabbitMQ%E5%9F%BA%E7%A1%80/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RabbitMQ基础">RabbitMQ基础</span>
            <span class="post-date" title="2022-08-27 16:26:14">2022/08/27</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/08/27/RabbitMQ%E5%8F%AF%E9%9D%A0%E6%80%A7-Spring/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RabbitMQ可靠性-Spring">RabbitMQ可靠性-Spring</span>
            <span class="post-date" title="2022-08-27 16:02:25">2022/08/27</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/08/27/RabbitMQ%E6%AD%BB%E4%BF%A1%E9%98%9F%E5%88%97%E3%80%81%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97-Spring/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RabbitMQ死信队列、延迟队列-Spring">RabbitMQ死信队列、延迟队列-Spring</span>
            <span class="post-date" title="2022-08-27 01:05:35">2022/08/27</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/08/23/MySQL%E4%BA%8B%E5%8A%A1%E4%B8%8E%E9%94%81/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="MySQL事务与锁">MySQL事务与锁</span>
            <span class="post-date" title="2022-08-23 12:49:38">2022/08/23</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/08/23/AOP%E5%AE%9E%E7%8E%B0%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AOP实现分布式锁">AOP实现分布式锁</span>
            <span class="post-date" title="2022-08-23 12:48:25">2022/08/23</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/08/23/ReentrantLock%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="ReentrantLock源码剖析">ReentrantLock源码剖析</span>
            <span class="post-date" title="2022-08-23 12:34:15">2022/08/23</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/08/23/%E5%8F%8D%E5%B0%84%E8%8E%B7%E5%8F%96AQS%E4%B8%AD%E5%90%8C%E6%AD%A5%E9%98%9F%E5%88%97%E4%B8%8E%E7%AD%89%E5%BE%85%E9%98%9F%E5%88%97%E7%9A%84%E9%95%BF%E5%BA%A6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="反射获取AQS中同步队列与等待队列的长度">反射获取AQS中同步队列与等待队列的长度</span>
            <span class="post-date" title="2022-08-23 12:32:58">2022/08/23</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2022/08/14/Spring%E3%80%81Servlet%E7%9B%91%E5%90%AC%E5%99%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Spring、Servlet监听器">Spring、Servlet监听器</span>
            <span class="post-date" title="2022-08-14 21:01:46">2022/08/14</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/08/13/AOP-%E5%8F%8D%E5%B0%84%EF%BC%9A%E6%8E%A5%E5%8F%A3%E5%8F%82%E6%95%B0%E6%A0%A1%E9%AA%8C/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="AOP+反射：接口参数校验">AOP+反射：接口参数校验</span>
            <span class="post-date" title="2022-08-13 17:12:17">2022/08/13</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/08/12/%E5%AF%B9dto%E6%8C%87%E5%AE%9A%E5%B1%9E%E6%80%A7%E4%B8%80%E9%94%AE%E5%8A%A0%E8%A7%A3%E5%AF%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="对dto指定属性一键加解密">对dto指定属性一键加解密</span>
            <span class="post-date" title="2022-08-12 22:51:17">2022/08/12</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/08/03/%E5%8F%8D%E5%B0%84%E4%BF%AE%E6%94%B9jsessionid%E5%AE%9E%E7%8E%B0session%E5%85%B1%E4%BA%AB/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="反射修改jsessionid实现session共享">反射修改jsessionid实现session共享</span>
            <span class="post-date" title="2022-08-03 21:53:21">2022/08/03</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/08/03/RestTemlate%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%8F%8A%E5%B7%A5%E5%85%B7%E7%B1%BB%E8%AE%BE%E8%AE%A1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="RestTemlate源码分析及工具类设计">RestTemlate源码分析及工具类设计</span>
            <span class="post-date" title="2022-08-03 21:51:57">2022/08/03</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/08/03/%E7%9F%AD%E4%BF%A1%E6%9C%8D%E5%8A%A1%E8%A2%AB%E6%94%BB%E5%87%BB%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="短信服务被攻击解决方案">短信服务被攻击解决方案</span>
            <span class="post-date" title="2022-08-03 21:51:16">2022/08/03</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/08/03/%E5%9B%9B%E7%A7%8D%E6%96%B9%E6%B3%95Servlet%E5%AE%B9%E5%99%A8%E4%BD%BF%E7%94%A8Spring%E7%9A%84Bean%E5%AF%B9%E8%B1%A1/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="四种方法Servlet容器使用Spring的Bean对象">四种方法Servlet容器使用Spring的Bean对象</span>
            <span class="post-date" title="2022-08-03 21:47:54">2022/08/03</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2022/07/19/%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E3%80%81%E7%B1%BB%E7%9A%84%E5%8A%A0%E8%BD%BD/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="内存区域、类的加载">内存区域、类的加载</span>
            <span class="post-date" title="2022-07-19 22:29:21">2022/07/19</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/07/19/Restful%E9%A3%8E%E6%A0%BC%E7%9C%9F%E7%9A%84%E6%9C%89%E5%BF%85%E8%A6%81%E5%90%97/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Restful风格真的有必要吗？">Restful风格真的有必要吗？</span>
            <span class="post-date" title="2022-07-19 20:19:57">2022/07/19</span>
        </a>
        
        <a  class="全部文章 机器学习 "
           href="/2022/07/17/%E6%B0%94%E8%B1%A1cv-%E5%9C%B0%E5%9F%BA%E4%BA%91%E5%9B%BE%E4%BA%91%E7%B3%BB%E5%88%86%E5%89%B2/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="气象cv-地基云图云系分割">气象cv-地基云图云系分割</span>
            <span class="post-date" title="2022-07-17 12:04:12">2022/07/17</span>
        </a>
        
        <a  class="全部文章 机器学习 "
           href="/2022/07/17/%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA%E6%9E%A3%E7%B1%BB%E9%81%97%E4%BC%A0%E7%9A%84%E5%9B%9E%E5%BD%92%E9%A2%84%E6%B5%8B/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="支持向量机枣类遗传的回归预测">支持向量机枣类遗传的回归预测</span>
            <span class="post-date" title="2022-07-17 11:47:04">2022/07/17</span>
        </a>
        
        <a  class="全部文章 机器学习 "
           href="/2022/07/17/%E6%B0%94%E8%B1%A1%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="气象大数据分析">气象大数据分析</span>
            <span class="post-date" title="2022-07-17 11:44:44">2022/07/17</span>
        </a>
        
        <a  class="全部文章 机器学习 "
           href="/2022/07/17/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E5%8D%95%E5%9B%BE%E8%B6%85%E5%88%86%E8%BE%A8%E7%8E%87%E7%9A%84%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="卷积神经网络单图超分辨率的深度学习方法">卷积神经网络单图超分辨率的深度学习方法</span>
            <span class="post-date" title="2022-07-17 11:33:07">2022/07/17</span>
        </a>
        
        <a  class="全部文章 机器学习 "
           href="/2022/07/17/%E7%96%AB%E6%83%85%E6%B8%AF%E5%8F%A3%E6%8C%82%E9%9D%A0%E6%95%B0ARIMA%E6%97%B6%E5%BA%8F%E5%88%86%E6%9E%90/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="疫情港口挂靠数ARIMA时序分析">疫情港口挂靠数ARIMA时序分析</span>
            <span class="post-date" title="2022-07-17 11:21:13">2022/07/17</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/07/15/OGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%94%B9%E9%80%A0%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="OGNL表达式改造以使用索引">OGNL表达式改造以使用索引</span>
            <span class="post-date" title="2022-07-15 22:27:54">2022/07/15</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/07/15/mvcc+%E6%8C%89%E5%A4%A9%E7%BC%93%E5%AD%98%E7%BB%9F%E8%AE%A1%E4%B8%A4%E4%B8%AA%E6%94%B6%E7%9B%8A/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="mvcc+按天缓存统计两个收益">mvcc+按天缓存统计两个收益</span>
            <span class="post-date" title="2022-07-15 21:35:25">2022/07/15</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/07/15/%E5%8E%8B%E7%BC%A9%E6%89%93%E5%8C%85%E4%BD%86%E4%B8%8D%E5%BD%92%E6%A1%A3%EF%BC%8C%E5%88%A9%E7%94%A8response/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="压缩打包但不归档，利用response">压缩打包但不归档，利用response</span>
            <span class="post-date" title="2022-07-15 21:26:51">2022/07/15</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/07/15/%E4%B8%9A%E5%8A%A1%E4%B8%ADdelete_flag%E5%AD%97%E6%AE%B5%E5%AE%B9%E6%98%93%E8%B8%A9%E7%9A%84%E5%9D%91/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="业务中delete_flag字段容易踩的坑">业务中delete_flag字段容易踩的坑</span>
            <span class="post-date" title="2022-07-15 21:19:19">2022/07/15</span>
        </a>
        
        <a  class="全部文章 工作笔记 "
           href="/2022/07/15/%E9%9D%9E%E6%97%B6%E5%BA%8F%E6%8E%92%E5%BA%8F%E4%B8%8B%E7%9A%84%E7%80%91%E5%B8%83%E6%B5%81%E5%88%86%E9%A1%B5/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="非时序排序下的瀑布流分页">非时序排序下的瀑布流分页</span>
            <span class="post-date" title="2022-07-15 21:15:15">2022/07/15</span>
        </a>
        
        <a  class="全部文章 数据结构算法 "
           href="/2022/06/25/%E8%A1%8C%E7%A8%8B%E7%BC%96%E7%A0%81%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="行程编码压缩图片">行程编码压缩图片</span>
            <span class="post-date" title="2022-06-25 01:35:20">2022/06/25</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2022/04/21/Filter%E7%9A%84%E5%B8%B8%E8%A7%81%E7%94%A8%E6%B3%95/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Filter的常见用法">Filter的常见用法</span>
            <span class="post-date" title="2022-04-21 09:51:40">2022/04/21</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2022/04/21/Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%92%8C%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Lambda表达式和方法引用">Lambda表达式和方法引用</span>
            <span class="post-date" title="2022-04-21 09:50:42">2022/04/21</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2022/04/21/Mybatis%E4%B8%ADxml%E4%B8%AD%E8%B0%83java%E6%96%B9%E6%B3%95OGNL%E8%A1%A8%E8%BE%BE%E5%BC%8F/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mybatis中xml中调java方法OGNL表达式">Mybatis中xml中调java方法OGNL表达式</span>
            <span class="post-date" title="2022-04-21 09:47:36">2022/04/21</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2022/04/21/Java%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java注解和反射">Java注解和反射</span>
            <span class="post-date" title="2022-04-21 09:45:15">2022/04/21</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/03/21/HashMap%E4%B8%ADentrySet-%E8%AF%A6%E8%A7%A3/"
           data-tag="HashMap"
           data-author="" >
            <span class="post-title" title="HashMap中entrySet()详解">HashMap中entrySet()详解</span>
            <span class="post-date" title="2022-03-21 00:15:10">2022/03/21</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/03/21/HashMap/"
           data-tag="HashMap"
           data-author="" >
            <span class="post-title" title="HashMap">HashMap</span>
            <span class="post-date" title="2022-03-21 00:13:23">2022/03/21</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/03/07/Mysql%E4%BA%8B%E5%8A%A1%E5%92%8C%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mysql事务和存储引擎">Mysql事务和存储引擎</span>
            <span class="post-date" title="2022-03-07 22:11:06">2022/03/07</span>
        </a>
        
        <a  class="全部文章 中间件 "
           href="/2022/03/07/Mysql-InnoDB-%E7%B4%A2%E5%BC%95%E5%8E%9F%E7%90%86%E5%8F%8A%E7%9A%84%E4%BD%BF%E7%94%A8/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Mysql(InnoDB)索引原理及的使用">Mysql(InnoDB)索引原理及的使用</span>
            <span class="post-date" title="2022-03-07 22:10:05">2022/03/07</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/02/21/LinkedList%E6%BA%90%E7%A0%81%E4%B8%AD%E4%B8%BA%E4%BD%95%E5%A4%A7%E9%87%8F%E5%87%BA%E7%8E%B0final/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="LinkedList源码中为何大量出现final">LinkedList源码中为何大量出现final</span>
            <span class="post-date" title="2022-02-21 09:57:35">2022/02/21</span>
        </a>
        
        <a  class="全部文章 源码 "
           href="/2022/02/20/LinkedList%E4%B8%ADclear%E5%92%8Cunlink%E5%A4%9A%E6%AC%A1%E7%BD%AEnull/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="LinkedList中clear和unlink方法为什么多次置null">LinkedList中clear和unlink方法为什么多次置null</span>
            <span class="post-date" title="2022-02-20 00:25:11">2022/02/20</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2022/02/20/gc%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="gc垃圾回收机制">gc垃圾回收机制</span>
            <span class="post-date" title="2022-02-20 00:17:43">2022/02/20</span>
        </a>
        
        <a  class="全部文章 机器学习 "
           href="/2022/01/11/%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E2%80%94%E2%80%94%E6%B3%B0%E5%9D%A6%E5%B0%BC%E5%85%8B%E5%8F%B7%E8%8E%B7%E6%95%91%E9%A2%84%E6%B5%8B/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="随机森林——泰坦尼克号获救预测">随机森林——泰坦尼克号获救预测</span>
            <span class="post-date" title="2022-01-11 03:06:10">2022/01/11</span>
        </a>
        
        <a  class="全部文章 机器学习 "
           href="/2022/01/01/%E5%86%B3%E7%AD%96%E6%A0%91-%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E2%80%94%E2%80%94%E7%94%A8%E6%88%B7%E6%B5%81%E5%A4%B1%E9%A2%84%E6%B5%8B%E7%9A%84%E6%A1%88%E4%BE%8B/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="决策树/随机森林——用户流失预测的案例">决策树/随机森林——用户流失预测的案例</span>
            <span class="post-date" title="2022-01-01 00:41:40">2022/01/01</span>
        </a>
        
        <a  class="全部文章 "
           href="/2021/12/25/IDEA%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="IDEA常用快捷键">IDEA常用快捷键</span>
            <span class="post-date" title="2021-12-25 21:55:46">2021/12/25</span>
        </a>
        
        <a  class="全部文章 Java "
           href="/2021/12/25/Java%E5%9B%9B%E7%A7%8Dnext%E7%94%A8%E6%B3%95/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Java四种next用法">Java四种next用法</span>
            <span class="post-date" title="2021-12-25 01:59:30">2021/12/25</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="切换全屏 快捷键 s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-MySQL窗口函数及滑窗原理" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">MySQL窗口函数及滑窗原理</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="中间件">中间件</a>
            
        </span>
        
        
    </div>
    <div class="article-meta">
        
            发布时间 : <time class="date" title='最后更新: 2022-11-27 22:23:34'>2022-11-27 22:13</time>
        
    </div>
    <div class="article-meta">
        
        <span>字数:1.6k</span>
        
        
        <span id="busuanzi_container_page_pv">
            阅读 :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%85%88%E7%9C%8B%E7%9C%8B%E5%A4%A7%E6%A6%82%E9%95%BF%E4%BB%80%E4%B9%88%E6%A0%B7%E5%AD%90%EF%BC%8Cover-%E6%98%AF%E4%BB%80%E4%B9%88%E5%90%AB%E4%B9%89"><span class="toc-text">1.先看看大概长什么样子，over()是什么含义</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E4%BB%A5sum-over-%E6%9D%A5%E4%B8%BE%E4%BE%8B"><span class="toc-text">2.以sum() over()来举例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E6%B0%B4%E6%9E%9C%E8%AE%A2%E5%8D%95%E8%A1%A8"><span class="toc-text">2.1 水果订单表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2%E9%BB%98%E8%AE%A4%E7%9A%84frame%EF%BC%8C%E5%8D%B3%E9%BB%98%E8%AE%A4%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3"><span class="toc-text">2.2默认的frame，即默认滑动窗口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-%E6%B2%A1%E6%9C%89partition%E4%B9%9F%E6%B2%A1%E6%9C%89order"><span class="toc-text">2.2.1 没有partition也没有order</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2%E5%8F%AA%E6%9C%89order-%E6%B2%A1%E6%9C%89partition"><span class="toc-text">2.2.2只有order 没有partition</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-%E6%9C%89partition-%E6%97%A0%E8%AE%BA%E6%9C%89%E6%B2%A1%E6%9C%89order"><span class="toc-text">2.2.3 有partition 无论有没有order</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3%E4%B8%8A%E9%9D%A2demo%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9Aframe%E5%8F%82%E6%95%B0"><span class="toc-text">2.3上面demo没有指定frame参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E6%8C%87%E5%AE%9Aframe%E6%BB%91%E7%AA%97%E8%8C%83%E5%9B%B4"><span class="toc-text">3.指定frame滑窗范围</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1%E6%BB%91%E7%AA%97%E7%AD%9B%E9%80%89%E5%8D%95%E4%BD%8D"><span class="toc-text">3.1滑窗筛选单位</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-ROWS%EF%BC%9A%E7%AD%9B%E9%80%89%E4%B8%80%E8%A1%8C"><span class="toc-text">3.1.1 ROWS：筛选一行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-RANGE%EF%BC%88%E6%9C%89%E6%8E%92%E5%BA%8F%EF%BC%89%EF%BC%9A%E7%AD%9B%E9%80%89%E4%B8%8A%E4%B8%8B%E8%BF%9E%E7%BB%AD%E7%9B%B8%E5%90%8C%E7%9A%84x%E5%AF%B9%E5%BA%94%E7%9A%84%E5%80%BC"><span class="toc-text">3.1.2 RANGE（有排序）：筛选上下连续相同的x对应的值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-RANGE%EF%BC%88%E6%97%A0%E6%8E%92%E5%BA%8F%EF%BC%89%EF%BC%9A%E7%AD%9B%E9%80%89%E5%BD%93%E5%89%8D%E8%A1%8C%E6%89%80%E5%9C%A8%E7%9A%84%E5%88%86%E5%8C%BA%E6%89%80%E6%9C%89%E8%A1%8C"><span class="toc-text">3.1.3 RANGE（无排序）：筛选当前行所在的分区所有行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2%E8%87%AA%E5%AE%9A%E4%B9%89%E7%81%B5%E6%B4%BB%E7%9A%84%E6%BB%91%E7%AA%97%E8%8C%83%E5%9B%B4"><span class="toc-text">3.2自定义灵活的滑窗范围</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BB%91%E7%AA%97%E8%8C%83%E5%9B%B4%E6%9C%89%EF%BC%9Aframe-start-%E5%92%8C-frame-between"><span class="toc-text">滑窗范围有：frame_start 和 frame_between</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1%E5%8F%AA%E6%8C%87%E5%AE%9A%E6%BB%91%E7%AA%97%E8%B5%B7%E7%82%B9frame-start"><span class="toc-text">3.2.1只指定滑窗起点frame_start</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2%E8%87%AA%E7%94%B1%E5%BA%A6%E6%9C%80%E9%AB%98%E7%9A%84frame-between"><span class="toc-text">3.3.2自由度最高的frame_between</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%9E%E9%99%85%E6%A1%88%E4%BE%8B"><span class="toc-text">4.实际案例</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%85%B6%E4%BB%96%E7%9A%84%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="toc-text">5.其他的窗口函数</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>窗口函数在统计类的需求中很常见，稍微复杂一点的查询需求就有可能用到它，使用窗口函数可以极大的简化我们的 SQL 语句。像 Oracle、SQL Server 这些数据库在较早的版本就支持窗口函数了，MySQL 直到 8.0 版本后才支持它。<br>一般来说涉及<strong>复杂的分组内问题如：</strong> </p>
<ul>
<li><strong>总是关注n几个记录</strong>（n日活跃汇总、n场直播观场汇总）</li>
<li><strong>按A分组，满足B时C的值</strong>（每个部门 A 工资 B 排名前n的员工 C 名字）</li>
<li><strong>行在每组的占比</strong>（每个员工占自己部门总工资的百分之多少）</li>
<li><strong>截止某条记录的统计值</strong>（订单表中，按品类分类，截止某个订单时一共赚了多少钱or平均赚了多少钱等等）</li>
</ul>
<p><strong>使用窗口函数可以替代大量的子查询，提升开发和执行效率</strong></p>
<p>窗口函数需要注意以下两点：</p>
<ul>
<li>窗口分为“<strong>静态窗口</strong>”和“<strong>滑动窗口</strong>”，<strong>窗口滑动的范围会影响窗口函数的值</strong>，这个范围可以根据业务需求自己设置</li>
<li>使用了窗口函数<code>over(partition by id)</code>时，出来的结果会<strong>按这个id字段排在一起</strong>（最终是否聚合要看外层有没有group by id）</li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/938e0b31e4b748a0bf2891c5b2109557.png"></p>
<ul>
<li>窗口函数分为“聚合”与“非聚合”</li>
</ul>
<h1 id="1-先看看大概长什么样子，over-是什么含义"><a href="#1-先看看大概长什么样子，over-是什么含义" class="headerlink" title="1.先看看大概长什么样子，over()是什么含义"></a>1.先看看大概长什么样子，over()是什么含义</h1><p>可以看到over()里面可以进行partition分区(就是分组的效果)、order by可以排序、后面有个RANGE字段放在第三点讲，<strong>这个RANGE或者ROW会影响over的作用效果</strong></p>
<pre><code>select distinct user_id,
   first_value(knowledge_name)
      over (partition by user_id order by score RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last,
   last_value(knowledge_name)
      over (partition by user_id order by score RANGE BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING)  as best
from tb_math_knowledge_point
</code></pre>
<p>同样的我们还可以对常见的SUM()函数接一个over()</p>
<pre><code>SELECT 
    *,
    SUM(quantity) OVER (PARTITION BY product ORDER BY quantity ROWS CURRENT ROW) AS sum1,
    SUM(quantity) OVER (PARTITION BY product ORDER BY quantity RANGE CURRENT ROW) AS sum2,
    SUM(quantity) OVER (PARTITION BY product RANGE CURRENT ROW) AS sum3
</code></pre>
<p>由此应该可以感觉到，这个<code>over()</code>就是所谓的窗口，<strong>我们可以在<code>over()</code>中控制滑动窗口的范围，从而取到不同的值</strong></p>
<h1 id="2-以sum-over-来举例"><a href="#2-以sum-over-来举例" class="headerlink" title="2.以sum() over()来举例"></a>2.以sum() over()来举例</h1><p>窗口函数的over()中有三个参数：分别是</p>
<ul>
<li>partition by</li>
<li>order by</li>
<li>frame 滑动窗口的范围</li>
</ul>
<p>在这一点的demo中会详细解释</p>
<h2 id="2-1-水果订单表"><a href="#2-1-水果订单表" class="headerlink" title="2.1 水果订单表"></a>2.1 水果订单表</h2><p><img src="https://img-blog.csdnimg.cn/0fc16478c8ff4b949e70d46fba706365.png"></p>
<h2 id="2-2默认的frame，即默认滑动窗口"><a href="#2-2默认的frame，即默认滑动窗口" class="headerlink" title="2.2默认的frame，即默认滑动窗口"></a>2.2默认的frame，即默认滑动窗口</h2><p>在over()中，frame也是有默认值（默认范围）的<br>根据是否有partition by、order by决定不同的默认值</p>
<h3 id="2-2-1-没有partition也没有order"><a href="#2-2-1-没有partition也没有order" class="headerlink" title="2.2.1 没有partition也没有order"></a>2.2.1 没有partition也没有order</h3><p>窗口范围是：<strong>所有行</strong>，这里即是sum对所有行进行求和</p>
<pre><code>SELECT 
    *,
    SUM(quantity) OVER () AS sum1
FROM sql_store.product_order;
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/7f6de296bc7442219e2090c08fe4ef85.png"></p>
<h3 id="2-2-2只有order-没有partition"><a href="#2-2-2只有order-没有partition" class="headerlink" title="2.2.2只有order 没有partition"></a>2.2.2只有order 没有partition</h3><p>窗口范围：<strong>第一个分区  到   所在行的分区</strong>，这里一般都不会这样单独用，深究意义不大<br><img src="https://img-blog.csdnimg.cn/f162c832aefb4e5eb18c73a7642f398f.png"></p>
<h3 id="2-2-3-有partition-无论有没有order"><a href="#2-2-3-有partition-无论有没有order" class="headerlink" title="2.2.3 有partition 无论有没有order"></a>2.2.3 有partition 无论有没有order</h3><p>窗口范围：<strong>该行的整个分区</strong>，注意与上面的区别，如果用partition限定了分区，则<strong>扫描到哪一行，就取那行对应的整个分区</strong></p>
<p><img src="https://img-blog.csdnimg.cn/1e4f09731ec243858a7ddf2df802ead0.png"></p>
<h2 id="2-3上面demo没有指定frame参数"><a href="#2-3上面demo没有指定frame参数" class="headerlink" title="2.3上面demo没有指定frame参数"></a>2.3上面demo没有指定frame参数</h2><p>上面的这个demo只在over()中指定了partition和order，因此<strong>无法自由控制滑动窗口的范围</strong></p>
<h1 id="3-指定frame滑窗范围"><a href="#3-指定frame滑窗范围" class="headerlink" title="3.指定frame滑窗范围"></a>3.指定frame滑窗范围</h1><p>这个fream参数其实叫框架，我这里为了方便理解直接写为了滑窗</p>
<h2 id="3-1滑窗筛选单位"><a href="#3-1滑窗筛选单位" class="headerlink" title="3.1滑窗筛选单位"></a>3.1滑窗筛选单位</h2><p>滑窗的<strong>筛选单位</strong>分为两种：{<code>ROWS</code> | <code>RANGE</code>}，默认值为RANGE<br>所谓<strong>筛选单位</strong>，就是：<strong>被视为同一个单位的几个行数据，一起进入窗口函数，并共享最终的唯一结果</strong></p>
<p>我们关于如下脚本，有3种不同的情况：<br><img src="https://img-blog.csdnimg.cn/edbe26dd42b84232bbbd098e567e54c7.png"></p>
<h3 id="3-1-1-ROWS：筛选一行"><a href="#3-1-1-ROWS：筛选一行" class="headerlink" title="3.1.1 ROWS：筛选一行"></a>3.1.1 ROWS：筛选一行</h3><p>SUM(quantity) OVER (PARTITION BY product ORDER BY quantity<code> ROWS CURRENT ROW) AS sum1</code><br>sum1中，<strong>使用ROWS作为基本单位</strong>，所以对<strong>每一行进行单独计算</strong>,sum(current row)统计值就是quantity本身</p>
<h3 id="3-1-2-RANGE（有排序）：筛选上下连续相同的x对应的值"><a href="#3-1-2-RANGE（有排序）：筛选上下连续相同的x对应的值" class="headerlink" title="3.1.2 RANGE（有排序）：筛选上下连续相同的x对应的值"></a>3.1.2 RANGE（有排序）：筛选上下连续相同的x对应的值</h3><p>sum2中，<strong>使用RANGE作为基本单位</strong>，<strong>apple 的第二、第三个订单数量都为10</strong>，所以<strong>第二、第三行视为一个单位</strong></p>
<p><img src="https://img-blog.csdnimg.cn/1d109e3d3c7a4e228e450297d37f396e.png"></p>
<h3 id="3-1-3-RANGE（无排序）：筛选当前行所在的分区所有行"><a href="#3-1-3-RANGE（无排序）：筛选当前行所在的分区所有行" class="headerlink" title="3.1.3 RANGE（无排序）：筛选当前行所在的分区所有行"></a>3.1.3 RANGE（无排序）：筛选当前行所在的分区所有行</h3><p>sum3中，<strong>使用RANGE作为基本单位</strong>，<strong>并且没有ORDER BY</strong>，<strong>所以每个分区为一个单位</strong></p>
<p><img src="https://img-blog.csdnimg.cn/c81e27a63c084edfa255c1498acc79be.png"></p>
<h2 id="3-2自定义灵活的滑窗范围"><a href="#3-2自定义灵活的滑窗范围" class="headerlink" title="3.2自定义灵活的滑窗范围"></a>3.2自定义灵活的滑窗范围</h2><p>个人认为跟上面的3.1滑窗筛选单位<code>ROWS</code>和<code>RANGE</code>属于一个包含关系，单位可以选择ROWS行、RANGE范围，<strong>都可以筛选一定的范围内，但比较死板，不够灵活</strong>，3.2就是这个升级版，足够灵活</p>
<ul>
<li>CURRENT ROW ：当前行</li>
<li>UNBOUNDED PRECEDING ：当前行上侧所有行</li>
<li>UNBOUNDED FOLLOWING ：当前行下侧所有行</li>
<li>expr PRECEDING：当前行上侧expr行(expr可以是数字，也可以是表达式)</li>
<li>expr FOLLOWING：当前行下侧expr行(expr可以是数字，也可以是表达式)<br><img src="https://img-blog.csdnimg.cn/7c9b83ed5b06468bb6458c3a7a6d62ee.png"></li>
</ul>
<p><strong>我们可以自由的进行组合，来达到自定义<code>分组(分区)内</code>滑窗范围的效果</strong><br>因此我们可以通过这种方式统计：</p>
<ul>
<li><strong>总是关注n几个记录</strong>（n日活跃汇总、n场直播观场汇总）</li>
<li><strong>按A分组，满足B时C的值</strong>（每个部门 A 工资 B 排名前n的员工 C 名字）</li>
<li><strong>行在每组的占比</strong>（每个员工占自己部门总工资的百分之多少）</li>
</ul>
<h3 id="滑窗范围有：frame-start-和-frame-between"><a href="#滑窗范围有：frame-start-和-frame-between" class="headerlink" title="滑窗范围有：frame_start 和 frame_between"></a>滑窗范围有：frame_start 和 frame_between</h3><p>一般来说用后者，前者是只指定滑窗起点，终点是默认值<br><strong>后者是起点终点都指定，最为灵活，也最为实用</strong></p>
<h3 id="3-2-1只指定滑窗起点frame-start"><a href="#3-2-1只指定滑窗起点frame-start" class="headerlink" title="3.2.1只指定滑窗起点frame_start"></a>3.2.1只指定滑窗起点frame_start</h3><p>仅指定开始行(或区域)，则结束范围为默认值，即<strong>当前行(或区域)</strong></p>
<p><img src="https://img-blog.csdnimg.cn/de6e0913bf5940ddb33afec1fb645e37.png"></p>
<h3 id="3-3-2自由度最高的frame-between"><a href="#3-3-2自由度最高的frame-between" class="headerlink" title="3.3.2自由度最高的frame_between"></a>3.3.2自由度最高的frame_between</h3><pre><code>SELECT 
    *,
    SUM(quantity) OVER
     (PARTITION BY product 
     ORDER BY quantity
     ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS sum
FROM sql_store.product_order
</code></pre>
<p><img src="https://img-blog.csdnimg.cn/26839a014ca044b5a92567c7ce3bfd08.png"></p>
<ul>
<li>因为指定了group by，所以按分组求和</li>
<li>因为指定了order by，所以有<strong>连续值被划为一个单位</strong>的可能，所以需要再用frame限定滑窗范围</li>
<li>语句设置了frame_start(<code>UNBOUNDED PRECEDING</code>)和frame_end(<code>CUREENT ROW</code>)，即框架范围为<strong>第一行至当前行</strong>，实现了<strong>累计求和</strong>的效果。</li>
</ul>
<h1 id="4-实际案例"><a href="#4-实际案例" class="headerlink" title="4.实际案例"></a>4.实际案例</h1><p><img src="https://img-blog.csdnimg.cn/1ea1f3376a1f4c2993f2e2dbbd0421f2.png"><br>如果要换成5.7版本的，不用窗口函数，那写起来就很庞大了<img src="https://img-blog.csdnimg.cn/7fe6e9472a924cfe8a8d44b9ac644e1e.png"></p>
<h1 id="5-其他的窗口函数"><a href="#5-其他的窗口函数" class="headerlink" title="5.其他的窗口函数"></a>5.其他的窗口函数</h1><p>这里面有很多，道理都一样（图片选自知乎）</p>
<p><img src="https://img-blog.csdnimg.cn/eabd7cc0f8d343d2b4d4eb21cd5820ca.jpeg"></p>

      
       <hr><span style="font-style: italic;color: gray;"> 生命以负熵为食，归整以抵抗熵增； </span>
    </div>
</article>







    
        <!-- MathJax配置，可通过单美元符号书写行内公式等 -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    "HTML-CSS": {
        preferredFont: "TeX",
        availableFonts: ["STIX","TeX"],
        linebreaks: { automatic:true },
        EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50)
    },
    tex2jax: {
        inlineMath: [ ["$", "$"], ["\\(","\\)"] ],
        processEscapes: true,
        ignoreClass: "tex2jax_ignore|dno",
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
        equationNumbers: { autoNumber: "AMS" },
        noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } },
        Macros: { href: "{}" }
    },
    messageStyle: "none"
    });
</script>
<!-- 给MathJax元素添加has-jax class -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<!-- 通过连接CDN加载MathJax的js代码 -->
<script type="text/javascript" async
        src="//cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<input type="hidden" id="MathJax-js"
        value="//cdn.jsdelivr.net/npm/mathjax@2.7.8/unpacked/MathJax.js?config=TeX-MML-AM_CHTML">
</input>
    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    ©2021 ZJH
</p>
<p class="footer-entry">"生命以负熵为食"

    </div>
    <div class="full-toc">
        <button class="full" data-title="切换全屏 快捷键 s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*渲染对应的表格样式*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*渲染打赏样式*/
        

        /*高亮代码块行号*/
        
        $('pre code').each(function(){
            var lines = $(this).text().trim().split('\n').length, widther='';
            if (lines>99) {
                widther = 'widther'
            }
            var $numbering = $('<ul/>').addClass('pre-numbering ' + widther).attr("unselectable","on");
            $(this).addClass('has-numbering ' + widther)
                    .parent()
                    .append($numbering);
            for(var i=1;i<=lines;i++){
                $numbering.append($('<li/>').text(i));
            }
        });
        

        /*访问数量*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*代码高亮，行号对齐*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*打赏页面隐藏与展示*/
    

</script>

<!--加入行号的高亮代码块样式-->

<style>
    pre{
        position: relative;
        margin-bottom: 24px;
        border-radius: 10px;
        border: 1px solid #e2dede;
        background: #FFF;
        overflow: hidden;
    }
    code.has-numbering{
        margin-left: 30px;
    }
    code.has-numbering.widther{
        margin-left: 35px;
    }
    .pre-numbering{
        margin: 0;
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        padding: 0.5em 3px 0.7em 5px;
        border-right: 1px solid #C3CCD0;
        text-align: right;
        color: #AAA;
        background-color: ;
    }
    .pre-numbering.widther {
        width: 35px;
    }
</style>

<!--自定义样式设置-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*列表样式*/
    

    /* 背景图样式 */
    
    


    /*引用块样式*/
    

    /*文章列表背景图*/
    

    
</style>







</html>
